# ğŸ¨ Diagrama Visual - Flujo de Balance Proporcional

## ğŸ“Š Flujo Completo: Cambio de Divisa con Abono Inicial

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENTE SOLICITA CAMBIO DE DIVISA                    â”‚
â”‚                                                                          â”‚
â”‚  Quiere: $1,000,000 COP                                                 â”‚
â”‚  Debe entregar: $250 USD (tasa: 4000)                                   â”‚
â”‚  Tiene disponible: $125 USD (50%)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PASO 1: CREAR TRANSACCIÃ“N PENDIENTE                  â”‚
â”‚                                                                          â”‚
â”‚  POST /api/exchanges                                                    â”‚
â”‚  {                                                                       â”‚
â”‚    monto_destino: 1000000,                                              â”‚
â”‚    abono_inicial_monto: 500000,  â—„â”€â”€ 50% del total                     â”‚
â”‚    saldo_pendiente: 500000,      â—„â”€â”€ 50% restante                      â”‚
â”‚    estado: "PENDIENTE"                                                  â”‚
â”‚  }                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CÃLCULO DE PORCENTAJE DE ACTUALIZACIÃ“N                     â”‚
â”‚                                                                          â”‚
â”‚  porcentajeActualizacion = abono_inicial / monto_total                  â”‚
â”‚  porcentajeActualizacion = 500000 / 1000000                             â”‚
â”‚  porcentajeActualizacion = 0.5 (50%)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ACTUALIZACIÃ“N PROPORCIONAL DE SALDOS (50%)                    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   MONEDA ORIGEN (USD)   â”‚         â”‚  MONEDA DESTINO (COP)   â”‚       â”‚
â”‚  â”‚      â†‘ INGRESO          â”‚         â”‚      â†“ EGRESO           â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ Efectivo: +$125 (50%)   â”‚         â”‚ Efectivo: -$500k (50%)  â”‚       â”‚
â”‚  â”‚ Billetes: +$125 (50%)   â”‚         â”‚ Billetes: -$500k (50%)  â”‚       â”‚
â”‚  â”‚ Bancos: $0              â”‚         â”‚ Bancos: $0              â”‚       â”‚
â”‚  â”‚ Monedas: $0             â”‚         â”‚ Monedas: $0             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                          â”‚
â”‚  âœ… Balance actualizado con 50% del monto total                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REGISTRO EN BASE DE DATOS                            â”‚
â”‚                                                                          â”‚
â”‚  CambioDivisa:                                                          â”‚
â”‚    â”œâ”€ id: "abc123"                                                      â”‚
â”‚    â”œâ”€ estado: "PENDIENTE"                                               â”‚
â”‚    â”œâ”€ monto_destino: 1000000                                            â”‚
â”‚    â”œâ”€ abono_inicial_monto: 500000                                       â”‚
â”‚    â”œâ”€ saldo_pendiente: 500000                                           â”‚
â”‚    â””â”€ numero_recibo_abono: "ABONO-..."                                  â”‚
â”‚                                                                          â”‚
â”‚  MovimientoSaldo:                                                       â”‚
â”‚    â”œâ”€ tipo_movimiento: "INGRESO"                                        â”‚
â”‚    â”œâ”€ monto: 500000                                                     â”‚
â”‚    â”œâ”€ referencia_tipo: "CAMBIO_DIVISA"                                  â”‚
â”‚    â””â”€ descripcion: "Abono inicial 50%"                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚
                        â° TIEMPO TRANSCURRE...
                        Cliente regresa con $125 USD restantes
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                PASO 2: CERRAR TRANSACCIÃ“N PENDIENTE                     â”‚
â”‚                                                                          â”‚
â”‚  PATCH /api/exchanges/abc123/cerrar                                     â”‚
â”‚                                                                          â”‚
â”‚  Sistema detecta:                                                       â”‚
â”‚    âœ“ huboAbonoInicial = true                                            â”‚
â”‚    âœ“ montoRestante = 1000000 - 500000 = 500000                         â”‚
â”‚    âœ“ porcentajeRestante = 500000 / 1000000 = 0.5 (50%)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ACTUALIZACIÃ“N DEL BALANCE RESTANTE (50% RESTANTE)                â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   MONEDA ORIGEN (USD)   â”‚         â”‚  MONEDA DESTINO (COP)   â”‚       â”‚
â”‚  â”‚      â†‘ INGRESO          â”‚         â”‚      â†“ EGRESO           â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ Efectivo: +$125 (50%)   â”‚         â”‚ Efectivo: -$500k (50%)  â”‚       â”‚
â”‚  â”‚ Billetes: +$125 (50%)   â”‚         â”‚ Billetes: -$500k (50%)  â”‚       â”‚
â”‚  â”‚ Bancos: $0              â”‚         â”‚ Bancos: $0              â”‚       â”‚
â”‚  â”‚ Monedas: $0             â”‚         â”‚ Monedas: $0             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                          â”‚
â”‚  âœ… Balance actualizado con 50% restante                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ACTUALIZACIÃ“N FINAL EN BASE DE DATOS                       â”‚
â”‚                                                                          â”‚
â”‚  CambioDivisa:                                                          â”‚
â”‚    â”œâ”€ id: "abc123"                                                      â”‚
â”‚    â”œâ”€ estado: "COMPLETADO" â—„â”€â”€ CambiÃ³ de PENDIENTE                     â”‚
â”‚    â”œâ”€ monto_destino: 1000000                                            â”‚
â”‚    â”œâ”€ abono_inicial_monto: 500000                                       â”‚
â”‚    â”œâ”€ saldo_pendiente: 0 â—„â”€â”€ CambiÃ³ de 500000                          â”‚
â”‚    â”œâ”€ numero_recibo_completar: "CIERRE-..." â—„â”€â”€ Nuevo                  â”‚
â”‚    â””â”€ fecha_completado: [fecha actual] â—„â”€â”€ Nuevo                        â”‚
â”‚                                                                          â”‚
â”‚  MovimientoSaldo (nuevo registro):                                      â”‚
â”‚    â”œâ”€ tipo_movimiento: "INGRESO"                                        â”‚
â”‚    â”œâ”€ monto: 500000                                                     â”‚
â”‚    â”œâ”€ referencia_tipo: "CAMBIO_DIVISA_CIERRE"                           â”‚
â”‚    â””â”€ descripcion: "Cierre - Monto restante: 500000.00"                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RESULTADO FINAL                                    â”‚
â”‚                                                                          â”‚
â”‚  Balance Total Actualizado:                                             â”‚
â”‚    USD: +$250 ($125 inicial + $125 cierre) âœ…                           â”‚
â”‚    COP: -$1,000,000 ($500k inicial + $500k cierre) âœ…                   â”‚
â”‚                                                                          â”‚
â”‚  TransacciÃ³n:                                                           â”‚
â”‚    Estado: COMPLETADO âœ…                                                â”‚
â”‚    Saldo Pendiente: $0 âœ…                                               â”‚
â”‚                                                                          â”‚
â”‚  AuditorÃ­a:                                                             â”‚
â”‚    2 registros en MovimientoSaldo âœ…                                    â”‚
â”‚    3 recibos generados (inicial, abono, cierre) âœ…                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ComparaciÃ³n: Antes vs DespuÃ©s

### **âŒ ANTES (Bug)**

```
PASO 1: Crear con abono inicial
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente paga: $500k de $1M (50%) â”‚
â”‚ Estado: PENDIENTE                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ Balance actualizado: $1M      â”‚  â—„â”€â”€ ERROR: Actualiza 100%
â”‚    (deberÃ­a ser $500k)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASO 2: Cerrar pendiente
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente paga: $500k restantes    â”‚
â”‚ Estado: COMPLETADO               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ Balance NO actualizado        â”‚  â—„â”€â”€ ERROR: No actualiza nada
â”‚    (deberÃ­a actualizar $500k)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESULTADO:
  Balance mostrado: $1M
  Dinero real recibido: $1M
  Diferencia: $0 âœ… (por suerte se compensan los errores)

  PERO si el cliente nunca completa el pago:
  Balance mostrado: $1M
  Dinero real recibido: $500k
  Diferencia: -$500k âŒ (balance inflado)
```

### **âœ… DESPUÃ‰S (Corregido)**

```
PASO 1: Crear con abono inicial
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente paga: $500k de $1M (50%) â”‚
â”‚ Estado: PENDIENTE                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Balance actualizado: $500k    â”‚  â—„â”€â”€ CORRECTO: Actualiza 50%
â”‚    (50% del total)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASO 2: Cerrar pendiente
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente paga: $500k restantes    â”‚
â”‚ Estado: COMPLETADO               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Balance actualizado: +$500k   â”‚  â—„â”€â”€ CORRECTO: Actualiza 50% restante
â”‚    (50% restante)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESULTADO:
  Balance mostrado: $1M ($500k + $500k)
  Dinero real recibido: $1M
  Diferencia: $0 âœ…

  Si el cliente nunca completa el pago:
  Balance mostrado: $500k
  Dinero real recibido: $500k
  Diferencia: $0 âœ… (balance correcto)
```

---

## ğŸ“ˆ Flujo de DecisiÃ³n: Â¿CuÃ¡ndo Actualizar Balance?

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Crear CambioDivisa â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Â¿Tiene abono_inicial?â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                             â”‚
                â–¼                             â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     SÃ      â”‚              â”‚     NO      â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚                             â”‚
                â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Estado = PENDIENTE    â”‚    â”‚ Estado = COMPLETADO   â”‚
    â”‚ Porcentaje = abono/   â”‚    â”‚ Porcentaje = 100%     â”‚
    â”‚              total    â”‚    â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                             â”‚
                â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Actualizar balance    â”‚    â”‚ Actualizar balance    â”‚
    â”‚ proporcionalmente     â”‚    â”‚ completo              â”‚
    â”‚ (ej: 50%)             â”‚    â”‚ (100%)                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                             â”‚
                â–¼                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚ Cliente regresa       â”‚                â”‚
    â”‚ para completar        â”‚                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                â”‚                             â”‚
                â–¼                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚ PATCH /cerrar o       â”‚                â”‚
    â”‚ PATCH /completar      â”‚                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                â”‚                             â”‚
                â–¼                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚ Calcular porcentaje   â”‚                â”‚
    â”‚ restante              â”‚                â”‚
    â”‚ (ej: 50% restante)    â”‚                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                â”‚                             â”‚
                â–¼                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚ Actualizar balance    â”‚                â”‚
    â”‚ con monto restante    â”‚                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                â”‚                             â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Balance actualizado â”‚
                   â”‚ correctamente       â”‚
                   â”‚ âœ… CONSISTENTE      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Matriz de Escenarios

| Escenario | Abono Inicial | Estado Inicial | % ActualizaciÃ³n Inicial | Estado Final | % ActualizaciÃ³n Final | Total Actualizado |
| --------- | ------------- | -------------- | ----------------------- | ------------ | --------------------- | ----------------- |
| **1**     | $0 (0%)       | COMPLETADO     | 100%                    | COMPLETADO   | 0%                    | 100% âœ…           |
| **2**     | $500k (50%)   | PENDIENTE      | 50%                     | COMPLETADO   | 50%                   | 100% âœ…           |
| **3**     | $300k (30%)   | PENDIENTE      | 30%                     | COMPLETADO   | 70%                   | 100% âœ…           |
| **4**     | $800k (80%)   | PENDIENTE      | 80%                     | COMPLETADO   | 20%                   | 100% âœ…           |
| **5**     | $1M (100%)    | COMPLETADO     | 100%                    | COMPLETADO   | 0%                    | 100% âœ…           |

**ConclusiÃ³n**: En todos los escenarios, el balance total actualizado es **100%** âœ…

---

## ğŸ”¢ FÃ³rmulas MatemÃ¡ticas

### **CreaciÃ³n con Abono Inicial**

```
porcentajeActualizacion = abono_inicial_monto / monto_destino

ingresoEfectivo = divisas_entregadas_efectivo Ã— porcentajeActualizacion
ingresoBancos = divisas_entregadas_transfer Ã— porcentajeActualizacion
ingresoBilletes = divisas_entregadas_billetes Ã— porcentajeActualizacion
ingresoMonedas = divisas_entregadas_monedas Ã— porcentajeActualizacion

egresoEfectivo = divisas_recibidas_efectivo Ã— porcentajeActualizacion
egresoBancos = divisas_recibidas_transfer Ã— porcentajeActualizacion
egresoBilletes = divisas_recibidas_billetes Ã— porcentajeActualizacion
egresoMonedas = divisas_recibidas_monedas Ã— porcentajeActualizacion
```

### **Cierre de Pendiente**

```
montoRestante = monto_destino - abono_inicial_monto
porcentajeRestante = montoRestante / monto_destino

ingresoEfectivoRestante = divisas_entregadas_efectivo Ã— porcentajeRestante
ingresoBancosRestante = divisas_entregadas_transfer Ã— porcentajeRestante
ingresoBilletesRestante = divisas_entregadas_billetes Ã— porcentajeRestante
ingresoMonedasRestante = divisas_entregadas_monedas Ã— porcentajeRestante

egresoEfectivoRestante = divisas_recibidas_efectivo Ã— porcentajeRestante
egresoBancosRestante = divisas_recibidas_transfer Ã— porcentajeRestante
egresoBilletesRestante = divisas_recibidas_billetes Ã— porcentajeRestante
egresoMonedasRestante = divisas_recibidas_monedas Ã— porcentajeRestante
```

### **VerificaciÃ³n de Consistencia**

```
Total Actualizado = ActualizaciÃ³n Inicial + ActualizaciÃ³n Cierre

Total Actualizado = (Monto Ã— %Inicial) + (Monto Ã— %Restante)
Total Actualizado = Monto Ã— (%Inicial + %Restante)
Total Actualizado = Monto Ã— 1.0
Total Actualizado = Monto âœ…

Ejemplo:
  Monto = $1,000,000
  Abono = $500,000 (50%)

  Inicial = $1,000,000 Ã— 0.5 = $500,000
  Cierre = $1,000,000 Ã— 0.5 = $500,000
  Total = $500,000 + $500,000 = $1,000,000 âœ…
```

---

## ğŸ¨ Leyenda de SÃ­mbolos

```
â”Œâ”€â”  Caja de proceso
â”‚ â”‚  Contenido
â””â”€â”˜

 â”‚   Flujo secuencial
 â–¼

 â”œâ”€  BifurcaciÃ³n
 â””â”€

 âœ…  Correcto / Exitoso
 âŒ  Error / Incorrecto
 âš ï¸  Advertencia
 ğŸ’¡  Sugerencia
 ğŸ”  VerificaciÃ³n
 ğŸ“Š  Datos / MÃ©tricas
 â°  Tiempo / Espera
 â—„â”€â”€ AnotaciÃ³n / Comentario
```

---

## ğŸ“± Vista Simplificada para MÃ³vil

```
FLUJO SIMPLE:

1ï¸âƒ£ CREAR CON ABONO
   Pago: $500 de $1000 (50%)
   â†“
   Balance: +$500 (50%)
   Estado: PENDIENTE

2ï¸âƒ£ ESPERAR
   Cliente regresa...

3ï¸âƒ£ CERRAR PENDIENTE
   Pago: $500 restantes (50%)
   â†“
   Balance: +$500 (50%)
   Estado: COMPLETADO

âœ… TOTAL: $1000 (100%)
```

---

**Ãšltima ActualizaciÃ³n**: 2025  
**VersiÃ³n**: 1.0  
**Estado**: âœ… COMPLETADO
